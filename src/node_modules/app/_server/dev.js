import path from "path"
import webpack from "webpack"
import WebpackDevServer from "webpack-dev-server"

const serverConfig = require(path.resolve("config/server.dev"))
const webpackConfig = require(path.resolve("config/webpack.dev"))

const compiler = webpack(webpackConfig)
compiler.plugin("done", stats => {
  console.log()
  console.log()
  console.log()
  console.log("Bundled in " + (stats.endTime - stats.startTime) + " ms")
})

const devServer = new WebpackDevServer(compiler, {
  publicPath: "/public/build/",
  hot: true,
  historyApiFallback: true,
  stats: {
    colors: true,
    chunkModules: false
  }
})

devServer.listen(serverConfig.devPort, () => {
  console.log("Dev server running at port " + devServer.io.httpServer.address().port)
})
