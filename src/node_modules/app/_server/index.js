import path from "path"
import {Server} from "hapi"
import Inert from "inert"
import h2o2 from "h2o2"
import routes from "app/_server/routes"

const config = require(path.resolve("config/server.dev"))

const server = new Server()
server.connection(config.connection)

server.register([Inert, h2o2], err => {
  if (err) {
    console.log("Load plugins failed", err)
  }
})

if (config.devPort) {
  server.route({
    method: "GET",
    path: "/public/build/{path*}",
    handler: {
      proxy: {
        host: config.connection.host,
        port: config.devPort,
        passThrough: true,
        xforward: true
      }
    }
  })
}

server.route(routes)

server.start(() => console.log("Server running at port " + server.info.port))
