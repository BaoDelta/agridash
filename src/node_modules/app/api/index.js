import {getReport, createReport, getReportViewData} from "app/api/handlers/report"
import {getGeosBySource} from "app/api/handlers/geo"
import {handlePromise} from "app/core/utils/handler"

const authRequired = {
  auth: {
    mode: "required"
  }
}

export function register(server, config, next) {
  server.route([
    {
      method: "GET",
      path: "/geo/source/{source}",
      handler: handlePromise(getGeosBySource)
    },
    {
      method: "GET",
      path: "/report/{id}",
      handler: handlePromise(getReport)
    },
    {
      method: "POST",
      path: "/report",
      handler: handlePromise(createReport),
      config: authRequired
    },
    {
      method: "GET",
      path: "/report/{id}/view/{viewId}/data",
      handler: handlePromise(getReportViewData)
    }
  ])
  next()
}

register.attributes = {
  name: "agridash-api"
}
