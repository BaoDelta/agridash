import React from "react"
import {get} from "app/_shared/utils/ajax"
import {filter, range} from "app/_shared/utils"
import {render as renderBlock} from "app/block/_client/widget"
import LoadingIcon from "app/_client/views/LoadingIcon"
import Collapse from "app/_client/views/Collapse"

const {Component, PropTypes} = React

class Block extends Component {

  static propTypes = {
    params: PropTypes.object.isRequired
  }

  componentDidMount() {
    const {params} = this.props
    get("/api/block/" + params.id).then(block => this.setState({
      block
    }))
    get("/api/block/" + params.id + "/data").then(data => this.setState({
      data
    }))
  }

  state = {}

  render() {
    const {block, data} = this.state
    if (!(block && data)) {
      return <LoadingIcon/>
    }
    const filteredData = filter(data, record => record.location === 9)
    return <div className="row">
      <div className="col-md-3">
        <div className="row">
          <Collapse id="categoryFilter" label="Category" icon="tag" className="col-lg-6">
            {range(1, 4).map(id => <div key={id} className="checkbox">
              <label>
                <input type="checkbox"/>
                {id}
              </label>
            </div>)}
          </Collapse>
          <Collapse id="locationFilter" label="Location" icon="map-marker" className="col-lg-6">
            {range(1, 11).map(id => <div key={id} className="checkbox">
              <label>
                <input type="checkbox"/>
                {id}
              </label>
            </div>)}
          </Collapse>
        </div>
      </div>
      <div className="col-md-9">
        <Collapse id="timeFilter" label="Time" icon="calendar">
          {range(2010, 2015).map(id => <div key={id} className="radio-inline">
            <label>
              <input type="radio"/>
              {id}
            </label>
          </div>)}
        </Collapse>
        <div className="card card-block">
          {renderBlock(block.widget, block, filteredData)}
        </div>
      </div>
    </div>
  }

}

export default Block
