import {findAll as findAllBlocks, findById as findBlockById} from "app/_shared/models/block"
import {load} from "app/block/_server/loader"
import {flatten} from "app/_shared/utils"

export function getAllBlocks(request, reply) {
  findAllBlocks().then(reply)
}

export function getBlock(request, reply) {
  findBlockById(+request.params.id).then(reply)
}

export function getBlockData(request, reply) {
  setTimeout(() => {
    findBlockById(+request.params.id)
      .then(block => Promise.all(block.data.category.map(category => load(category, block))))
      .then(data => flatten(data))
      .then(reply)
  }, 500)
}
