import sql from "app/core/utils/sql"

export function getNextSessionId() {
  return sql.first(sql.raw("nextval('mapresult_sequence') as id"))
  .then(session => +session.id)
}

export function create(sessionId, resultId, data) {
  const selectValues = sql.select(sql.raw(`${sessionId}, ${resultId}, '${JSON.stringify(data)}'`))
    .whereNotExists(sql.select(1).from("mapresult").where({
      sessionid: sessionId,
      resultid: resultId
    }))
  return sql.insert(sql.raw(`(sessionid, resultid, data) ${selectValues.toString()}`)).into("mapresult")
}
