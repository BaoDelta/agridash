import sql from "app/core/utils/sql"
import {fromCache, TTL_SHORT} from "app/core/utils/cache"

export function findByUsername(username, requireHash) {
  return fromCache(`user/${username}`, TTL_SHORT, () => sql.first().from("appuser").where("username", username)
  .then(user => {
    if (!user) {
      return user
    }
    return {
      ...user,
      id: +user.id
    }
  }))
  .then(user => {
    if (requireHash) {
      return user
    }
    const {hash, ...userWithoutHash} = user
    return userWithoutHash
  })
}
