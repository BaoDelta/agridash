import {createLogger} from "bunyan"

const log = createLogger({name: "handler"})

export function handlePromise(handler) {
  const onFulfilled = handler.then || (reply => response => {
    reply(response)
  })
  const onRejected = handler.catch || (reply => error => {
    log.error(error, {
      data: error.data
    })
    reply(error)
  })
  return (request, reply) => {
    return Promise.resolve(handler(request)).then(onFulfilled(reply), onRejected(reply))
  }
}
