import _ from "lodash"
import sql from "app/utils/sql"

export function createCachedModel(table) {
  let allModels = null
  function findAll() {
    return allModels ? Promise.resolve(allModels) : sql.select().from(table).then(models => {
      console.log("Load " + table + ": " + models.length)
      allModels = models
      return models
    })
  }
  function find(predicate) {
    return findAll().then(models => _.find(models, predicate))
  }
  function findById(id) {
    return find(model => model.id === id)
  }
  return {
    findAll,
    find,
    findById
  }
}
