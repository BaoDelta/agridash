import {load} from "app/block/loader"

function groupByYear(config) {
  const promises = []
  config.fields.forEach(field => {
    promises.push(load({
      ...field,
      year: config.year
    }))
  })
  return Promise.all(promises).then(data => {
    const records = []
    const recordByYear = {}
    for (let year = config.year[0]; year <= config.year[1]; ++year) {
      const record = {
        year
      }
      records.push(record)
      recordByYear[record.year] = record
    }
    config.fields.forEach((field, index) => {
      data[index].forEach(entry => {
        const record = recordByYear[entry.year]
        record[field.id] = entry.value
      })
    })
    return records
  })
}

export default groupByYear
