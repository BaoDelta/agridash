import path from "path"
import {Server} from "hapi"

const config = require(path.resolve("src/config"))

const server = new Server()
server.connection({
  labels: ["web"],
  host: config.web.host,
  port: config.web.port
})
server.connection({
  labels: ["api"],
  host: config.api.host,
  port: config.api.port
})
server.connection({
  labels: ["tile"],
  host: config.tile.host,
  port: config.tile.port
})

server.connections.forEach(connection => {
  const label = connection.settings.labels[0]
  server.select(label).register({
    register: require("app/" + label),
    options: config
  }, error => {
    if (error) {
      console.log("Load plugins failed for " + label, error)
    }
  })
})

server.start(() => {
  server.connections.forEach(connection => {
    console.log("Server " + connection.settings.labels[0] + " running at: " + connection.info.uri)
    if (config.debug.showRoutes) {
      connection.table().forEach(route => {
        console.log(route.path)
      })
    }
  })
})
