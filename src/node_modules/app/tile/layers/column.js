const columnLayer = {
  name: "column",
  bufferSize: 64,
  render: request => ({
    query: `
      select geom, level, base * level * 2 as height from (
        select st_rotate(st_expand(pos, !pixel_width! * 6), -pi() / 8, pos) as geom, (id * 5) % 4 + 1 as level,
        !pixel_width! * 6 as base from geo
        where source = '${request.query.s}' order by lat desc, lng desc
      ) tmp
    `,
    style: `<Style name="column">
      <Rule>
        <Filter>[level] = 1</Filter>
        <BuildingSymbolizer fill="#ffeda0" height="[height]" fill-opacity="0.8"/>
      </Rule>
      <Rule>
        <Filter>[level] = 2</Filter>
        <BuildingSymbolizer fill="#ffeda0" height="[height]" fill-opacity="0.8"/>
      </Rule>
      <Rule>
        <Filter>[level] = 3</Filter>
        <BuildingSymbolizer fill="#ffeda0" height="[height]" fill-opacity="0.8"/>
      </Rule>
      <Rule>
        <Filter>[level] = 4</Filter>
        <BuildingSymbolizer fill="#ffeda0" height="[height]" fill-opacity="0.8"/>
      </Rule>
    </Style>`
  })
}

export default columnLayer
