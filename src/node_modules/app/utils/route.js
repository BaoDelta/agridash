import _ from "lodash"
import {renderReact} from "app/_server/handlers"

function join(...paths) {
  return "/" + _.compact(_.flatten(paths.map(path => path.split("/")))).join("/")
}

function convertParams(path) {
  return path.split("/").map(token => {
    if (_.startsWith(token, ":")) {
      return "{" + token.substring(1) + "}"
    }
    return token
  }).join("/")
}

export function addClientRoutes(routes, clientRoutes, parentPath) {
  let routePath = clientRoutes.path
  if (routePath) {
    if (!_.startsWith(routePath, "/")) {
      routePath = join(parentPath, routePath)
    }
    routePath = convertParams(routePath)
    routes.push({
      path: routePath,
      handler: renderReact
    })
  }
  if (clientRoutes.childRoutes) {
    clientRoutes.childRoutes.forEach(childRoute => {
      addClientRoutes(routes, childRoute, routePath)
    })
  }
}
