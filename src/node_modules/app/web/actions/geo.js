import {createAction} from "redux-actions"
import {get} from "app/core/utils/ajax"

export const GEO_REQUEST_GEOS = "GEO_REQUEST_GEOS"
export const GEO_RECEIVE_GEOS = "GEO_RECEIVE_GEOS"

export const requestGeos = createAction(GEO_REQUEST_GEOS)
export const receiveGeos = createAction(GEO_RECEIVE_GEOS)

const {clientConfig} = window
const {apiUrl} = clientConfig

export function fetchGeos(source) {
  return (dispatch, getState) => {
    const {geo: geoState} = getState()
    if (geoState[source]) {
      return geoState[source].promise || Promise.resolve()
    }
    const promise = get(`${apiUrl}/geo/source/${source}`).then(geos => dispatch(receiveGeos({
      source,
      geos
    })))
    dispatch(requestGeos({
      source,
      promise
    }))
    return promise
  }
}
