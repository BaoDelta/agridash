import {createAction} from "redux-actions"
import {get} from "app/core/utils/ajax"

export const REQUEST_GEOS = "REQUEST_GEOS"
export const RECEIVE_GEOS = "RECEIVE_GEOS"

export const requestGeos = createAction(REQUEST_GEOS)
export const receiveGeos = createAction(RECEIVE_GEOS)

export function getGeos(source) {
  return (dispatch, getState) => {
    const {info, geo: {[source]: geoState}} = getState()
    if (geoState && geoState.geos) {
      return Promise.resolve()
    }
    dispatch(requestGeos({
      source
    }))
    return get(`${info.apiUrl}/geo/source/${source}`)
    .then(geos => dispatch(receiveGeos({
      source,
      geos
    })))
  }
}
