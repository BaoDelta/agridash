import {createAction} from "redux-actions"
import {get} from "app/core/utils/ajax"

export const REQUEST_GEOS = "REQUEST_GEOS"
export const RECEIVE_GEOS = "RECEIVE_GEOS"

export const requestGeos = createAction(REQUEST_GEOS)
export const receiveGeos = createAction(RECEIVE_GEOS)

export function fetchGeos(source) {
  return (dispatch, getState) => {
    const {info, geo: geoState} = getState()
    if (geoState[source]) {
      return geoState[source].promise || Promise.resolve()
    }
    const promise = get(`${info.apiUrl}/geo/source/${source}`).then(geos => {
      dispatch(receiveGeos({
        source,
        geos
      }))
    })
    dispatch(requestGeos({
      source,
      promise
    }))
    return promise
  }
}
