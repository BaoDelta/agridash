import {createAction} from "redux-actions"
import {get} from "app/core/utils/ajax"

export const GEOS_REQUEST = "GEOS_REQUEST"
export const GEOS_RECEIVE = "GEOS_RECEIVE"

export const requestGeos = createAction(GEOS_REQUEST)
export const receiveGeos = createAction(GEOS_RECEIVE)

const {clientConfig} = window
const {apiUrl} = clientConfig

export function fetchGeos(source) {
  return (dispatch, getState) => {
    const state = getState()
    if (state.geos[source]) {
      return Promise.resolve()
    }
    dispatch(requestGeos(source))
    return get(`${apiUrl}/geo/source/${source}`).then(geos => dispatch(receiveGeos({
      source,
      geos
    })))
  }
}
