import {createAction} from "redux-actions"
import {get} from "app/core/utils/ajax"
import {updateModel} from "app/web/actions/model"

export const UPDATE_INFO = "UPDATE_INFO"

export const updateInfo = createAction(UPDATE_INFO)

export function updateUser(user) {
  return dispatch => {
    if (!user) {
      return dispatch(updateInfo({
        userId: null
      }))
    }
    dispatch(updateModel({
      user: {
        [user.id]: user
      }
    }))
    return dispatch(updateInfo({
      userId: user.id
    }))
  }
}

export function logout() {
  return (dispatch, getState) => {
    const {info} = getState()
    const done = () => dispatch(updateUser(null))
    return get(`${info.apiUrl}/logout`)
    .then(done, done)
  }
}
