import "es5-shim"
import "app/web/patches/bootstrap"
import "app/web/patches/alpaca"
import "app/web/patches/leaflet"

import React from "react"
import {render} from "react-dom"
import {Router, Route, Redirect} from "react-router"
import createHistory from "history/lib/createBrowserHistory"
import App from "app/web/views/App"
import Report from "app/web/views/Report"
import NotFound from "app/web/views/NotFound"
import NewReportForm from "app/web/views/NewReportForm"
import LoginForm from "app/web/views/LoginForm"
import {dispatch} from "app/web/store"
import {updateInfo} from "app/web/actions/info"

const history = createHistory()

dispatch(updateInfo(window.appInfo))

render(<Router history={history}>
  <Route path="/" component={App}>
    <Route path="login" component={LoginForm}/>
    <Route path="report">
      <Route path="new" component={NewReportForm}/>
      <Route path=":id/view/:viewId" component={Report}/>
    </Route>
    <Redirect from="/r/:id/v/:viewId" to="/report/:id/view/:viewId"/>
    <Redirect from="/report/:id/v/:viewId" to="/report/:id/view/:viewId"/>
    <Redirect from="/r/:id/view/:viewId" to="/report/:id/view/:viewId"/>
    <Route path="*" component={NotFound}/>
  </Route>
</Router>, document.getElementById("appContent"))
