import {flatten} from "app/core/utils"
import config from "app/config"

const {libs, cache} = config.cdn
const {publicPath} = config.webpack
const clientConfig = {
  apiUrl: config.api.url,
  tileUrl: config.tile.url
}
const styles = flatten(libs.map(lib => lib.styles.map(style => `${cache || lib.url}/${style}`)))
const scripts = flatten(libs.map(lib => lib.scripts.map(script => `${cache || lib.url}/${script}`)))

function renderReact(request, reply) {
  reply(`<!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <meta http-equiv="x-ua-compatible" content="ie=edge"/>
        <title>AgriDash</title>
        <link type="image/x-icon" rel="icon" href="/favicon.ico"/>
        ${styles.map(style => `
          <link type="text/css" rel="stylesheet" href="${style}"/>
        `).join("")}
      </head>
      <body>
        <div id="appContent"></div>
        <script type="text/javascript">
          window.clientConfig = ${JSON.stringify(clientConfig)}
        </script>
        ${scripts.map(script => `
          <script type="text/javascript" src="${script}"></script>
        `).join("")}
        <script type="text/javascript" src="${publicPath}vendors.js"></script>
        <script type="text/javascript" src="${publicPath}app.js"></script>
      </body>
    </html>`)
}

export default renderReact
