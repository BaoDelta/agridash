import path from "path"
import Inert from "inert"
import renderReact from "app/web/handlers/renderReact"
import {login, logout} from "app/web/handlers/auth"
import {handlePromise} from "app/core/utils/handler"

export function register(server, options, next) {
  server.register(Inert, next)
  server.path(path.join(__dirname, "public"))
  server.route([
    {
      method: "GET",
      path: "/favicon.ico",
      handler: {file: "./favicon.ico"},
      config: {cache: {expiresIn: 24 * 60 * 60 * 1000, privacy: "public"}}
    },
    {
      method: "GET",
      path: "/public/{path*}",
      handler: {directory: {path: "./"}}
    },
    {
      method: "POST",
      path: "/login",
      handler: handlePromise(login)
    },
    {
      method: "GET",
      path: "/logout",
      handler: logout
    },
    {
      method: "GET",
      path: "/{path*}",
      handler: renderReact
    }
  ])
  next()
}

register.attributes = {
  name: "agridash-web"
}
