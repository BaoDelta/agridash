import "app/lib/leaflet.fullscreen/1.3.0/Control.FullScreen.js"
import "app/lib/leaflet.fullscreen/1.3.0/Control.FullScreen.css"

import L from "leaflet"
import React from "react"
import {render, unmountComponentAtNode} from "react-dom"
import {assign, remove} from "app/core/utils"

// Clear controls when removing a map
const {addTo, removeFrom} = L.Control.prototype
assign(L.Control.prototype, {
  addTo(map) {
    map._controls = map._controls || []
    map._controls.push(this)
    return addTo.call(this, map)
  },
  removeFrom(map) {
    if (map._controls) {
      remove(map._controls, this)
    }
    return removeFrom.call(this, map)
  }
})

const {_clearControlPos} = L.Map.prototype
assign(L.Map.prototype, {
  _clearControlPos() {
    if (this._controls) {
      this._controls.forEach(control => {
        control.removeFrom(this)
      })
      this._controls = null
    }
    _clearControlPos.call(this)
  }
})

// Create control from a React component
assign(L.Control, {
  fromReact(Control, options) {
    return L.Control.extend({
      options,
      onAdd() {
        const container = L.DomUtil.create("div", "")
        render(<Control options={options}/>, container)
        return container
      },
      onRemove() {
        unmountComponentAtNode(this.getContainer())
      }
    })
  }
})
