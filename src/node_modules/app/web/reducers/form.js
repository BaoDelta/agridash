import {handleActions} from "redux-actions"

import {INIT_FORM, REMOVE_FORM, SET_DATA_SOURCE, REQUEST_RESULT, RECEIVE_RESULT, REJECT_RESULT}
  from "app/web/actions/form"

const formReducer = handleActions({
  [INIT_FORM]: (state, action) => ({
    ...state,
    [action.payload.id]: action.payload
  }),
  [REMOVE_FORM]: (state, action) => {
    const {[action.payload.id]: form, ...others} = state
    return others
  },
  [REQUEST_RESULT]: (state, action) => {
    const {[action.payload.id]: form} = state
    return {
      ...state,
      [form.id]: {
        ...form,
        loading: true,
        loadError: null,
        result: null
      }
    }
  },
  [RECEIVE_RESULT]: (state, action) => {
    const {[action.payload.id]: form} = state
    return {
      ...state,
      [form.id]: {
        ...form,
        loading: false,
        loadError: null,
        result: action.payload.result
      }
    }
  },
  [REJECT_RESULT]: (state, action) => {
    const {[action.payload.id]: form} = state
    return {
      ...state,
      [form.id]: {
        ...form,
        loading: false,
        loadError: action.payload.error,
        result: null
      }
    }
  },
  [SET_DATA_SOURCE]: (state, action) => {
    const {[action.payload.id]: form} = state
    return {
      ...state,
      [form.id]: {
        ...form,
        dataSource: {
          ...form.dataSource,
          [action.payload.name]: action.payload.data
        }
      }
    }
  }
}, {})

export default formReducer
