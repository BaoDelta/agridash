import React from "react"
import {connect} from "react-redux"
import {createForm} from "app/web/forms/common"
import {getSchema as getAuthSchema, getOptions as getAuthOptions} from "app/web/forms/auth"
import {updateInfo} from "app/web/actions/info"

const {Component, PropTypes} = React

class LoginForm extends Component {

  static propTypes = {
    dispatch: PropTypes.func.isRequired,
    history: PropTypes.object.isRequired
  }

  componentDidMount() {
    this.removeForm = createForm(this.refs.container, getAuthSchema(), getAuthOptions(), {
      url: "/login",
      buttonLabel: "Log In",
      done: user => {
        this.props.dispatch(updateInfo({
          user
        }))
        this.props.history.replaceState(null, "/")
      }
    })
  }

  componentWillUnmount() {
    if (this.removeForm) {
      this.removeForm()
    }
  }

  render() {
    return <div ref="container"></div>
  }

}

export default connect()(LoginForm)
