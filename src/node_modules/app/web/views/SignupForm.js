import React from "react"
import {connect} from "react-redux"
import createForm from "app/web/forms/form"
import {getSchema as getSignupSchema, getOptions as getSignupOptions} from "app/web/forms/signup"
import {updateInfo} from "app/web/actions/info"

const {Component, PropTypes} = React

class SignupForm extends Component {

  static propTypes = {
    dispatch: PropTypes.func.isRequired,
    history: PropTypes.object.isRequired
  }

  componentDidMount() {
    this.removeForm = createForm(this.refs.container, getSignupSchema(), getSignupOptions(), {
      url: "/user",
      buttonLabel: "Sign Up",
      done: user => {
        this.props.dispatch(updateInfo({
          user
        }))
        this.props.history.replaceState(null, `/user/${user.username}`)
      }
    })
  }

  componentWillUnmount() {
    if (this.removeForm) {
      this.removeForm()
    }
  }

  render() {
    return <div ref="container"></div>
  }

}

export default connect()(SignupForm)
